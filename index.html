<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ğŸŒ Live Traffic Monitor - DDoS Mitigation</title>
  <style>
    body { font-family: Arial; background: #181818; color: white; text-align: center; }
    h1 { margin-top: 20px; }
    canvas { background: #222; border-radius: 10px; padding: 10px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>ğŸŒ Live Traffic Monitor</h1>
  <p>DDoS Mitigation</p>
  <canvas id="rpsChart" width="600" height="300"></canvas>

  <script>
    const workerBaseUrl = "https://worker.hcydgt.workers.dev"; // URL Worker Anda
    const ctx = document.getElementById('rpsChart').getContext('2d');

    let chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Requests Per Second (RPS)',
          data: [],
          borderColor: 'lime',
          backgroundColor: 'rgba(0,255,0,0.1)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: { ticks: { color: 'white' } },
          y: { 
            ticks: { color: 'white', beginAtZero: true }, // Pastikan mulai dari nol
            min: 0 // Pastikan min y-axis adalah 0
          } 
        },
        plugins: { legend: { labels: { color: 'white' } } }
      }
    });

    // Fungsi untuk mengambil data dan memperbarui chart
    function updateChart() {
      // Kirim hit ke Worker setiap kali fungsi ini dipanggil
      // Ini memastikan Pages.dev "memberitahu" Worker tentang adanya traffic
      fetch(workerBaseUrl) // Default endpoint Worker untuk mencatat hit
        .then(hitResponse => {
            // Setelah mencatat hit, ambil data stats
            return fetch(workerBaseUrl + "/stats");
        })
        .then(res => res.json())
        .then(data => {
          let time = new Date().toLocaleTimeString();
          chart.data.labels.push(time);
          chart.data.datasets[0].data.push(data.rps);

          // Batasi jumlah data pada chart
          if (chart.data.labels.length > 20) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
          }
          chart.update();
        })
        .catch(error => {
            console.error("Error fetching data:", error);
        });
    }

    // Panggil pertama kali saat halaman dimuat
    updateChart();

    // Update data setiap detik
    setInterval(updateChart, 1000);
  </script>
</body>
</html>
