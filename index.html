<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>🌐 Live Traffic Monitor - DDoS Mitigation</title>
  <style>
    body { font-family: Arial; background: #181818; color: white; text-align: center; }
    h1 { margin-top: 20px; }
    canvas { background: #222; border-radius: 10px; padding: 10px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>🌐 Live Traffic Monitor</h1>
  <p>DDoS Mitigation</p>
  <canvas id="rpsChart" width="600" height="300"></canvas>

  <script>
    // URL Worker Anda adalah tempat semua traffic akan masuk
    const workerBaseUrl = "https://worker.hcydgt.workers.dev"; // URL Worker Anda

    const ctx = document.getElementById('rpsChart').getContext('2d');

    let chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Requests Per Second (RPS)',
          data: [],
          borderColor: 'lime',
          backgroundColor: 'rgba(0,255,0,0.1)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: { ticks: { color: 'white' } },
          y: { 
            ticks: { color: 'white', beginAtZero: true },
            min: 0
          } 
        },
        plugins: { legend: { labels: { color: 'white' } } }
      }
    });

    // Fungsi untuk mengambil data dan memperbarui chart
    function updateChart() {
      // Pages.dev hanya perlu mengambil data statistik dari Worker
      fetch(workerBaseUrl + "/stats")
        .then(res => res.json())
        .then(data => {
          let time = new Date().toLocaleTimeString();
          chart.data.labels.push(time);
          chart.data.datasets[0].data.push(data.rps);

          if (chart.data.labels.length > 20) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
          }
          chart.update();
        })
        .catch(error => {
            console.error("Error fetching stats data:", error);
        });
    }

    // Panggil pertama kali saat halaman dimuat
    updateChart();

    // Update data setiap detik
    setInterval(updateChart, 1000);
  </script>
</body>
</html>
